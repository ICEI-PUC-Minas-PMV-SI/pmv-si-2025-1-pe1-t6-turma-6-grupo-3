<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Caderno SurfBook</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      padding: 30px;
      text-align: center;
    }
    h1, p {
      margin: 0;
    }
    .editor {
      max-width: 700px;
      margin: 30px auto 0;
      text-align: left;
    }
    .block {
      background: transparent;
      padding: 12px;
      margin-bottom: 6px;
      border: 1px solid transparent;
      border-radius: 4px;
      position: relative;
      transition: background 0.2s ease;
    }
    .block:hover {
      background: #ffffffaa;
    }
    .inner {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .content {
      flex: 1;
      outline: none;
      color: #333;
    }
    .block-controls {
      position: absolute;
      left: -50px;
      top: 10px;
      display: flex;
      flex-direction: inherit;
      gap: 5px;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .block:hover .block-controls {
      opacity: 1;
    }
    .block-controls button {
      border: none;
      background: none;
      cursor: grab;
      font-size: 16px;
    }
    .menu {
      position: absolute;
      top: 30px;
      left: -160px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: none;
      flex-direction: column;
      min-width: 140px;
      z-index: 10;
    }
    .menu button {
      background: none;
      border: none;
      padding: 10px;
      text-align: left;
      width: 100%;
      cursor: pointer;
      font-size: 14px;
    }
    .menu button:hover {
      background: #f0f0f0;
    }
    .drag-over {
      border: 2px dashed #aaa;
    }
    .checked .content {
      text-decoration: line-through;
      color: #999;
    }
    .comment {
      font-size: 13px;
      color: #555;
      margin-top: 4px;
      padding-left: 30px;
    }
    .comment[contenteditable]:empty:before {
      content: "Escreva um comentÃ¡rio...";
      color: #aaa;
    }
    .menuBtn {
      cursor: pointer;
      font-size: 20px;
      padding: 5px;
      background-color: transparent;
      border: none;
      color: #333;
    }
    .menuBtn:hover {
      background-color: #e0e0e0;
      border-radius: 5px;
    }
    .color-picker {
      padding: 10px;
      font-size: 14px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 10px;
      border: none;
      background: none;
      cursor: pointer;
    }
    .color-indicator {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      border: 1px solid #aaa;
    }
    .color-picker input[type="color"] {
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 0;
      width: 20px;
      height: 20px;
    }
  </style>
</head>
<body>

  <h1>ComeÃ§ando com o Caderno</h1>
  <p>Bem-vindo ao caderno ðŸ‘‹</p>
  <main class="editor" id="editor"></main>

  <script>
    const editor = document.getElementById("editor");

    const initial_nodes = [
      {
        type: "title", // "title", "paragraph", "ordered_list", "unordered_list", "action_list", "image", "link_bookmark"
        position: 0,
        customStyle: "",
        id: "",
        value: "Meu Titulo",
      },
      {
        type: "paragraph", // "title", "paragraph", "ordered_list", "unordered_list", "action_list", "image", "link_bookmark"
        position: 1,
        customStyle: "",
        id: "",
        value: "Uma descricao qualquer",
      },
      {
        type: "unordered_list", // "title", "paragraph", "ordered_list", "unordered_list", "action_list", "image", "link_bookmark"
        position: 2,
        customStyle: "",
        id: "",
        "value": "AÃ§ucar \tSal \tManteiga",
      },
      {
        type: "unordered_list", // "title", "paragraph", "ordered_list", "unordered_list", "action_list", "image", "link_bookmark"
        position: 3,
        customStyle: "",
        id: "",
        "value": "Item 1  \tItem 2  \tItem 3",
      },
      {
        type: "unordered_list", // "title", "paragraph", "ordered_list", "unordered_list", "action_list", "image", "link_bookmark"
        position: 4,
        customStyle: "",
        id: "",
        "value": "Item",
      },
    ];
    
    function getBlock() {
      const block = document.createElement("div");
      block.className = "block";
      return block;
    }

    function getControls() {
      const controls = document.createElement("div");
      controls.className = "block-controls";
      return controls;
    }

    function getAddBtn() {
      const addBtn = document.createElement("button");
      addBtn.textContent = "+";
      addBtn.onclick = () => {
        const newBlock = createBlock();
        editor.insertBefore(newBlock, block.nextSibling);
        newBlock.querySelector(".content").focus();
      };
      return addBtn
    }

    function getMenuBtn(){
      const menuBtn = document.createElement("button");
      menuBtn.className = "menuBtn";
      menuBtn.title = "Arraste para mover\nClique para abrir o menu";
      menuBtn.textContent = "â‹®â‹®";
      menuBtn.draggable = true;

      return menuBtn;
    }

    function removeCheckbox() {
        const existingCheckbox = block.querySelector('input[type="checkbox"]');
        if (existingCheckbox) existingCheckbox.remove();
        block.classList.remove('checked');
    }

    function checkbox() {
      const checkboxBtn = document.createElement("button");
      checkboxBtn.textContent = "âœ… Adicionar/Remover Checkbox";
      checkboxBtn.onclick = () => {
        const existingCheckbox = block.querySelector('input[type="checkbox"]');
        if (existingCheckbox) {
          existingCheckbox.remove();
        } else {
          const newCheckbox = document.createElement('input');
          newCheckbox.type = "checkbox";
          newCheckbox.addEventListener('change', () => {
            block.classList.toggle('checked', newCheckbox.checked);
          });
          inner.insertBefore(newCheckbox, content);
        }
    }
  }

    function render({type, position, customStyle, id, value}, content) {
      content.style.cssText = '';
      content.innerHTML = '';
      switch(type) {
        case "title":
          content.innerText = value;
          content.style.fontSize = "24px";
          content.style.fontWeight = "bold";
          break;
        case "paragraph": 
          content.innerText = value;
          content.style.fontSize = "16px";
          break;
        case "ordered_list": 
          
          content.style.fontSize = "16px";
          content.style.fontWeight = "normal";
          break;
        case "unordered_list": 
            const items = value.split("\t");
            content.innerHTML = `<ul>${items.map(li_value => `<li>${li_value}</li>`)}</ul>`;
            content.style.fontSize = "16px";
            content.style.fontWeight = "normal";
          break;
        case "action_list": 
          break;
        case "image": 
          break;
        case "link_bookmark": 
          break;
      }
    }

    function getMenu({actions}) {
      const {deleteMe} = actions;

      const menu = document.createElement("div");
      menu.className = "menu";

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "ðŸ—‘ï¸ Excluir bloco";
      deleteBtn.onclick = deleteMe;

      // const colorPickerBtn = document.createElement("div");
      // colorPickerBtn.className = "color-picker";

      // const colorLabel = document.createElement("span");
      // colorLabel.textContent = "ðŸŽ¨ Cor do bloco:";

      // const colorInput = document.createElement("input");
      // colorInput.type = "color";
      // colorInput.value = "#ffffff";

      // const colorIndicator = document.createElement("div");
      // colorIndicator.className = "color-indicator";
      // colorIndicator.style.backgroundColor = "#ffffff";

      // colorInput.addEventListener("input", () => {
      //   block.style.backgroundColor = colorInput.value;
      //   colorIndicator.style.backgroundColor = colorInput.value;
      // });

      // colorPickerBtn.appendChild(colorLabel);
      // colorPickerBtn.appendChild(colorInput);
      // colorPickerBtn.appendChild(colorIndicator);

      // const titleBtn = document.createElement("button");
      // titleBtn.textContent = "ðŸ”  Transformar em TÃ­tulo";
      // titleBtn.onclick = () => {
      //   removeCheckbox();
      //   content.style.fontSize = "24px";
      //   content.style.fontWeight = "bold";
      // };

      // const paragraphBtn = document.createElement("button");
      // paragraphBtn.textContent = "ðŸ“œ Transformar em ParÃ¡grafo";
      // paragraphBtn.onclick = () => {
      //   removeCheckbox();
      //   content.style.fontSize = "16px";
      //   content.style.fontWeight = "normal";
      // };

      // const bulletListBtn = document.createElement("button");
      // bulletListBtn.textContent = "â€¢ Lista com Marcadores";
      // bulletListBtn.onclick = () => {
      //   removeCheckbox();
      //   content.innerHTML = '<ul><li>Item 1</li><li>Item 2</li></ul>';
      //   content.style.fontSize = "16px";
      //   content.style.fontWeight = "normal";
      // };

      // const numberListBtn = document.createElement("button");
      // numberListBtn.textContent = "1ï¸âƒ£ Lista Numerada";
      // numberListBtn.onclick = () => {
      //   removeCheckbox();
      //   content.innerHTML = '<ol><li>Item 1</li><li>Item 2</li></ol>';
      //   content.style.fontSize = "16px";
      //   content.style.fontWeight = "normal";
      // };

      // const duplicateBtn = document.createElement("button");
      // duplicateBtn.textContent = "ðŸ“‹ Duplicar";
      // duplicateBtn.onclick = () => {
      //   const copy = createBlock();
      //   copy.querySelector(".content").innerText = content.innerText;
      //   copy.style.backgroundColor = block.style.backgroundColor;  // Copiar a cor de fundo
      //   editor.insertBefore(copy, block.nextSibling);
      //   copy.querySelector(".content").focus();
      // };

      // const commentBtn = document.createElement("button");
      // commentBtn.textContent = "ðŸ’¬ Adicionar ComentÃ¡rio";
      // commentBtn.onclick = () => {
      //   if (!block.querySelector(".comment")) {
      //     const comment = document.createElement("div");
      //     comment.className = "comment";
      //     comment.contentEditable = true;
      //     comment.textContent = "";
      //     block.appendChild(comment);
      //     comment.focus();
      //   }
      // };

      // const addImageBtn = document.createElement("button");
      // addImageBtn.textContent = "ðŸ–¼ï¸ Adicionar Imagem";
      // addImageBtn.onclick = () => {
      //   const imageUrl = prompt("Digite a URL da imagem:");
      //   if (imageUrl) {
      //     const img = document.createElement("img");
      //     img.src = imageUrl;
      //     img.style.width = "100%";
      //     block.appendChild(img);
      //   }
      // };

      // const removeImageBtn = document.createElement("button");
      // removeImageBtn.textContent = "âŒ Remover Imagem";
      // removeImageBtn.onclick = () => {
      //   const img = block.querySelector("img");
      //   if (img) img.remove();
      // };

      // const boldBtn = document.createElement("button");
      // boldBtn.textContent = "ðŸ…±ï¸ Negrito";
      // boldBtn.onclick = () => {
      //   document.execCommand("bold");
      // };

      // const italicBtn = document.createElement("button");
      // italicBtn.textContent = "ð“˜ ItÃ¡lico";
      // italicBtn.onclick = () => {
      //   document.execCommand("italic");
      // };

      // const underlineBtn = document.createElement("button");
      // underlineBtn.textContent = "ðŸ–‹ï¸ Sublinhado";
      // underlineBtn.onclick = () => {
      //   document.execCommand("underline");
      // };

      
      // };

      menu.appendChild(deleteBtn);
      // menu.appendChild(colorPickerBtn);
      // menu.appendChild(titleBtn);
      // menu.appendChild(paragraphBtn);
      // menu.appendChild(bulletListBtn);
      // menu.appendChild(numberListBtn);
      // menu.appendChild(duplicateBtn);
      // menu.appendChild(commentBtn);
      // menu.appendChild(addImageBtn);
      // menu.appendChild(removeImageBtn);
      // menu.appendChild(boldBtn);
      // menu.appendChild(italicBtn);
      // menu.appendChild(underlineBtn);
      // menu.appendChild(checkboxBtn);
      return menu
    }

    function getContent({onBlur, onEnterPress}){
      const content = document.createElement("div");
      content.className = "content";
      content.contentEditable = true;
      content.addEventListener('blur', onBlur);
      content.addEventListener('keydown', e => {
        switch (e.key){
          case "Enter": onEnterPress(e); break;
        }
      });
      return content;
    }
    function extractValueFromContent(node, content) {
      let value;
      switch(node.type) {
        case "title":
        case "paragraph": 
          value = content.innerHTML;
          break;
        case "ordered_list": 
        case "unordered_list": 
            value = content.childNodes[0].childNodes[0].innerHTML
            break;
          break;
        case "action_list": 
          break;
        case "image": 
          break;
        case "link_bookmark": 
          break;
      } 
      return value;
    }
    function createBlock(node) {
      const {type, position, customStyle, id} = node;
      const block = getBlock();

      const controls = getControls();

      const addBtn = getAddBtn();

      const menuBtn = getMenuBtn();

      const menu = getMenu({
        actions: {
                    // id => delete no dado
          deleteMe: () => block.remove()
        }
      });

      block.appendChild(menu);

      menuBtn.onclick = (e) => {
        e.stopPropagation();
        closeAllMenus();
        menu.style.display = 'flex';
      };

      controls.appendChild(addBtn);
      controls.appendChild(menuBtn);
      block.appendChild(controls);

      const inner = document.createElement("div");
      inner.className = "inner";

      const content = getContent({
        onBlur: e => {
          const new_value = extractValueFromContent(node, content);
          console.log('node type', node.type);
          console.log('novo valor', new_value);
          node.value = new_value;
          console.log('Conteudo no dado', node.value);
        },
        onEnterPress: e => {
          switch (node.type) {
            case "ordered_list": 
            case "unordered_list": 
              node.value = `${node.value}\t`
              render({type, position, customStyle, id, value: node.value}, content);
              const lastItem = content.childNodes[0].childNodes[0];
              // lastItem.focus();
              // lastItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
              break;
          }
        }
      });
      render({type, position, customStyle, id, value: node.value}, content);
      inner.appendChild(content);
      block.appendChild(inner);

     

      menuBtn.addEventListener('dragstart', () => {
        draggedBlock = block;
        block.style.opacity = "0.5";
        menuBtn.style.cursor = "grabbing";
      });

      menuBtn.addEventListener('dragend', () => {
        draggedBlock = null;
        block.style.opacity = "1";
        menuBtn.style.cursor = "grab";
      });

      block.addEventListener('dragover', (e) => {
        e.preventDefault();
        block.classList.add('drag-over');
      });

      block.addEventListener('dragleave', () => {
        block.classList.remove('drag-over');
      });

      block.addEventListener('drop', (e) => {
        e.preventDefault();
        block.classList.remove('drag-over');
        if (draggedBlock && block !== draggedBlock) {
          const offset = e.clientY - block.getBoundingClientRect().top;
          const shouldInsertAfter = offset > block.clientHeight / 2;
          editor.insertBefore(draggedBlock, shouldInsertAfter ? block.nextSibling : block);
        }
      });

      document.addEventListener('click', () => {
        menu.style.display = 'none';
      });

      return block;
    }

    function closeAllMenus() {
      document.querySelectorAll('.menu').forEach(menu => {
        menu.style.display = 'none';
      });
    }

    window.onload = () => {
      // for (let i = 0; i < 8; i++) {
      initial_nodes.forEach(node =>  editor.appendChild(createBlock(node)) 
     );
      // }
    };
  </script>
</body>
</html>