<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Login</title>
	<link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    	<link rel="stylesheet" href="../componentes/form-login/form.css">
        <script src="../componentes/form-login/create-form-login.js"></script>
</head>

<body>
    <div id="login">
		
  </div>
    <script src="../scripts/notebooks-client.js"></script>
    <script src="../scripts/content-metadata-client.js"></script>
    <script src="../scripts/content-nodes-client.js"></script>
    <script src="../scripts/user-client.js"></script>

    <script src="../scripts/storage.js"></script>
    <script src="../scripts/session-manager.js"></script>
    <script src="../scripts/url-service.js"></script>
    <script src="../scripts/app.js"></script>
    <script>

        if (session.isLogged()) {
            window.location.href = HOME_URL;
        }

         const preview = document.getElementById('login');

        Promise.all([
            fetch('../componentes/form-login/form.html').then(res => res.text()),
        ]).then(([htmlForm]) => {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = htmlForm;


                const memory = {
                    email: "",
                    password: "",
                };
                const fields = [
                    createLoginField(document, wrapper, {
                        placeholder: "Insira seu email",
                        type: "email",
                        name: "email",
                        actions: {
                        blur: (e, el) => {
                            console.log("update email to:", el.value);
                            memory.email = el.value;
                        }
                        }
                    }),
                    createLoginField(document, wrapper, {
                        placeholder: "Digite sua senha",
                        type: "password",
                        name: "senha",
                        actions: {
                            blur: (e, el) => {
                                console.log("update password to:", el.value);
                                memory.password = el.value;
                        }
                        }
                    })
                ];

                const buttons = [
                    createLoginButton(document, wrapper, {
                        name: "Entrar",
                        isPrimary: true,
                        actions: {
                            click: (ev, el) => {
                                ev.preventDefault();
                                console.log("CLIcKOU Entrar");
                                const err = session.signin({
                                    email: memory.email,
                                    password: memory.password
                                });
                                if (err) {
                                    alert (err.message);
                                    return;
                                }
                                window.location.href = HOME_URL;
                            }
                        }
                    }),
                    createLoginButton(document, wrapper, {
                        name: "Cadastrar",
                        isOutline: true,
                        actions: {
                        click: (ev, el) => {
                            console.log("CLIcKOU Cadastrar");
                            window.location.assign("/src/pages/cadastrar-v2.html")
                        }
                        }
                    }),
                ]

            preview.appendChild(createLoginForm(document, wrapper, { 
                withLogo: true,
                title: "Login",
                fields,
                buttons,
            }))
        });

    </script>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>    
</body>
</html>